<!DOCTYPE html>
<html>
<body>

<h1>tetr.io damage calculator</h1>

<p>Enter individual attacks and the calculator will calculate damage sent according to the <a href="https://cdn.discordapp.com/attachments/674421736162197515/716081165886423110/2020-05-30_02-07-18.png">tetr.io attack table</a>. Maybe add importing custom attack tables later idk</p>
<p>As per the chart, your first combo or B2B is your 0th. Thus a <b><i>non</i></b> combo/B2B is represented with a -1. Be cognizant of that when setting base values.</p>
<p>Combo chains and B2B chains are assumed for consecutive inputted attacks. To break combo chain, enter a None attack; to break B2B, enter a non-Quad/T-Spin/None attack (a single/double/triple).</p>
<span>Disclaimer: I barely know what I'm doing.</span>
<p>Disclaimer 2: Damage may be inaccurate past 20combo. Check the code for the specifics on my jank implementation.</p>
<p>Disclaimer 3: The additive math used for high B2Bs is correct at low combo, but at high B2B high combo the numbers do not line up with osk chart or with in-game testing. Pls let me (swng#1965) know if you have any insights :3</p>
    
<button onclick="calculate()">Calculate</button>
<p></p>

<label>Base combo (default -1)<input type="number" id="base combo" min="-1"></label>
<label>Base B2B (default -1)<input type="number" id="base B2B" min="-1"></label>


<p></p>

<!-- Hardcoding each line, thonk... -->
<!-- I would prefer to have number of lines controlled by a user-controlled variable, but don't know how to do that... -->

<label for="attack type 0">Attack type:</label>
<select id="attack type 0">
    <option value=-1>None</option>
    <option value=0>Single</option>
    <option value=1>Double</option>
    <option value=2>Triple</option>
    <option value=3>Quad</option>
    <option value=4>T-Spin Mini Single</option>
    <option value=5>T-Spin Single</option>
    <option value=6>T-Spin Mini Double</option>
    <option value=7>T-Spin Double</option>
    <option value=8>T-Spin Triple</option>
</select>
<label for="PC 0">PC?</label> 
<input type="checkbox" id="PC 0">

<span>Damage: </span>
<span id="damage 0">0</span>

<p></p>

<label for="attack type 1">Attack type:</label>
<select id="attack type 1">
    <option value=-1>None</option>
    <option value=0>Single</option>
    <option value=1>Double</option>
    <option value=2>Triple</option>
    <option value=3>Quad</option>
    <option value=4>T-Spin Mini Single</option>
    <option value=5>T-Spin Single</option>
    <option value=6>T-Spin Mini Double</option>
    <option value=7>T-Spin Double</option>
    <option value=8>T-Spin Triple</option>
</select>
<label for="PC 1">PC?</label> 
<input type="checkbox" id="PC 1">

<span>Damage: </span>
<span id="damage 1">0</span>

<p></p>

<label for="attack type 2">Attack type:</label>
<select id="attack type 2">
    <option value=-1>None</option>
    <option value=0>Single</option>
    <option value=1>Double</option>
    <option value=2>Triple</option>
    <option value=3>Quad</option>
    <option value=4>T-Spin Mini Single</option>
    <option value=5>T-Spin Single</option>
    <option value=6>T-Spin Mini Double</option>
    <option value=7>T-Spin Double</option>
    <option value=8>T-Spin Triple</option>
</select>
<label for="PC 2">PC?</label> 
<input type="checkbox" id="PC 2">

<span>Damage: </span>
<span id="damage 2">0</span>

<p></p>

<label for="attack type 3">Attack type:</label>
<select id="attack type 3">
    <option value=-1>None</option>
    <option value=0>Single</option>
    <option value=1>Double</option>
    <option value=2>Triple</option>
    <option value=3>Quad</option>
    <option value=4>T-Spin Mini Single</option>
    <option value=5>T-Spin Single</option>
    <option value=6>T-Spin Mini Double</option>
    <option value=7>T-Spin Double</option>
    <option value=8>T-Spin Triple</option>
</select>
<label for="PC 3">PC?</label> 
<input type="checkbox" id="PC 3">

<span>Damage: </span>
<span id="damage 3">0</span>

<p></p>

<label for="attack type 4">Attack type:</label>
<select id="attack type 4">
    <option value=-1>None</option>
    <option value=0>Single</option>
    <option value=1>Double</option>
    <option value=2>Triple</option>
    <option value=3>Quad</option>
    <option value=4>T-Spin Mini Single</option>
    <option value=5>T-Spin Single</option>
    <option value=6>T-Spin Mini Double</option>
    <option value=7>T-Spin Double</option>
    <option value=8>T-Spin Triple</option>
</select>
<label for="PC 4">PC?</label> 
<input type="checkbox" id="PC 4">

<span>Damage: </span>
<span id="damage 4">0</span>

<p></p>

<label for="attack type 5">Attack type:</label>
<select id="attack type 5">
    <option value=-1>None</option>
    <option value=0>Single</option>
    <option value=1>Double</option>
    <option value=2>Triple</option>
    <option value=3>Quad</option>
    <option value=4>T-Spin Mini Single</option>
    <option value=5>T-Spin Single</option>
    <option value=6>T-Spin Mini Double</option>
    <option value=7>T-Spin Double</option>
    <option value=8>T-Spin Triple</option>
</select>
<label for="PC 5">PC?</label> 
<input type="checkbox" id="PC 5">

<span>Damage: </span>
<span id="damage 5">0</span>

<p></p>

<label for="attack type 6">Attack type:</label>
<select id="attack type 6">
    <option value=-1>None</option>
    <option value=0>Single</option>
    <option value=1>Double</option>
    <option value=2>Triple</option>
    <option value=3>Quad</option>
    <option value=4>T-Spin Mini Single</option>
    <option value=5>T-Spin Single</option>
    <option value=6>T-Spin Mini Double</option>
    <option value=7>T-Spin Double</option>
    <option value=8>T-Spin Triple</option>
</select>
<label for="PC 6">PC?</label> 
<input type="checkbox" id="PC 6">

<span>Damage: </span>
<span id="damage 6">0</span>

<p></p>

<label for="attack type 7">Attack type:</label>
<select id="attack type 7">
    <option value=-1>None</option>
    <option value=0>Single</option>
    <option value=1>Double</option>
    <option value=2>Triple</option>
    <option value=3>Quad</option>
    <option value=4>T-Spin Mini Single</option>
    <option value=5>T-Spin Single</option>
    <option value=6>T-Spin Mini Double</option>
    <option value=7>T-Spin Double</option>
    <option value=8>T-Spin Triple</option>
</select>
<label for="PC 7">PC?</label> 
<input type="checkbox" id="PC 7">

<span>Damage: </span>
<span id="damage 7">0</span>

<p></p>

<label for="attack type 8">Attack type:</label>
<select id="attack type 8">
    <option value=-1>None</option>
    <option value=0>Single</option>
    <option value=1>Double</option>
    <option value=2>Triple</option>
    <option value=3>Quad</option>
    <option value=4>T-Spin Mini Single</option>
    <option value=5>T-Spin Single</option>
    <option value=6>T-Spin Mini Double</option>
    <option value=7>T-Spin Double</option>
    <option value=8>T-Spin Triple</option>
</select>
<label for="PC 8">PC?</label> 
<input type="checkbox" id="PC 8">

<span>Damage: </span>
<span id="damage 8">0</span>

<p></p>

<label for="attack type 9">Attack type:</label>
<select id="attack type 9">
    <option value=-1>None</option>
    <option value=0>Single</option>
    <option value=1>Double</option>
    <option value=2>Triple</option>
    <option value=3>Quad</option>
    <option value=4>T-Spin Mini Single</option>
    <option value=5>T-Spin Single</option>
    <option value=6>T-Spin Mini Double</option>
    <option value=7>T-Spin Double</option>
    <option value=8>T-Spin Triple</option>
</select>
<label for="PC 9">PC?</label> 
<input type="checkbox" id="PC 9">

<span>Damage: </span>
<span id="damage 9">0</span>

<p></p>

<label for="attack type 10">Attack type:</label>
<select id="attack type 10">
    <option value=-1>None</option>
    <option value=0>Single</option>
    <option value=1>Double</option>
    <option value=2>Triple</option>
    <option value=3>Quad</option>
    <option value=4>T-Spin Mini Single</option>
    <option value=5>T-Spin Single</option>
    <option value=6>T-Spin Mini Double</option>
    <option value=7>T-Spin Double</option>
    <option value=8>T-Spin Triple</option>
</select>
<label for="PC 10">PC?</label> 
<input type="checkbox" id="PC 10">

<span>Damage: </span>
<span id="damage 10">0</span>

<p></p>

<span>Total Damage:</span>
<span id="total damage">0</span>





<script>


var num_attacks = 11;

// lol hardcoded attack table. Hopefully I didn't typo when typing them out...
// they do follow patterns so should be able to do it without a hardcoded attack table for arbitrarily large inputs... but whatever
var AttackTable = [ // straight taken from osk's table: https://cdn.discordapp.com/attachments/674421736162197515/716081165886423110/2020-05-30_02-07-18.png
    [0,0,1,1,1,1,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3], // Single
    [1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,6], // Double. Increments every 4 combos.
    [2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12], // Triple. Increments every 2 combos.
    [4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24], // Quad. Increments every combo.
    [0,0,1,1,1,1,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3], // T-Spin Mini Single. Same as single, but gets B2B.
    [2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12], // T-Spin Single. Same as triple, but gets B2B.
    [1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,6], // T-Spin Mini Double. Same as double, but gets B2B.
    [4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24], // T-Spin Double. Same as quad.
    [6,7,9,10,12,13,15,16,18,19,21,22,24,25,27,28,30,31,33,34,36], // T-Spin Triple. Increments every combo and by 2 every 2 combos.    
]

function attackTable(type, combo) {
    if (type == -1) { return 0;}
    if (combo < 20) return AttackTable[type][combo]; // anything past this idk for sure
    if (type == 0 || type == 4) {
        return AttackTable[type][20]; // eh I don't know the pattern
    }
    if (type == 1 || type == 6) {
        return Math.floor((combo+4)/4);
    }
    if (type == 2 || type == 5) {
        return Math.floor((combo+4)/2);
    }
    if (type == 3 || type == 7) {
        return combo+4;
    }
    if (type == 8) {
        return Math.floor((combo+12)/2) + i;
    }
    return AttackTable[type][20];
    
}

function B2B_bonus(B2B) {
    if (B2B < 1) return 0;
    if (B2B < 3) return 1;
    if (B2B < 8) return 2;
    if (B2B < 24) return 3;
    if (B2B < 67) return 4;
    if (B2B < 185) return 5;
    if (B2B < 504) return 6;
    if (B2B < 1370) return 7;
    return 8; // if there's a B2B level past lv 8 I don't know

}

function calculate() {

    var type_0 = document.getElementById("attack type 0").value;
    var PC_0 = document.getElementById("PC 0").checked;

    var combo_0 = (document.getElementById("base combo").valueAsNumber);
    if (isNaN(combo_0)) combo_0 = -1;
    if (type_0 != -1) combo_0++;

    var B2B_0 = (document.getElementById("base B2B").valueAsNumber);
    if (isNaN(B2B_0)) B2B_0 = -1;
    if (type_0 >=3) B2B_0++;
    var B2B_bonus_0 = B2B_bonus(B2B_0);

    if (type_0 == -1) {   var damage_0 = 0; }
    else {                var damage_0 = attackTable(type_0, combo_0) + B2B_bonus_0; }
    if (PC_0) {damage_0 += 10;} // technically PC damage comes separately and that should be indicated but whatever

    document.getElementById("damage 0").innerHTML = damage_0;

    types = [type_0];
    combos = [combo_0];
    B2Bs = [B2B_0];
    damages = [damage_0];

    for (i = 1; i < num_attacks ; i++) {
        var type = document.getElementById("attack type " + i.toString()).value;
        var PC = document.getElementById("PC " + i.toString()).checked;

        types.push(type);

        var combo = combos[i-1] + 1;
        if (type == -1) {combo = -1; }
        combos.push(combo);

        var B2B = B2Bs[i-1];
        if (type >= 0 && type <= 2) { B2B = -1;}
        if (type >= 3) { B2B++;}
        B2Bs.push(B2B);

        if (type == -1) { var damage = 0; }
        else {
            var damage = attackTable(type,combo) + B2B_bonus(B2B);
        }

        if (PC) {damage += 10;}

        damages.push(damage);
        document.getElementById("damage " + i.toString()).innerHTML = damage;


    }
    
    var total = damages.reduce((a, b) => a + b, 0);
    console.log(damages, total);
    document.getElementById("total damage").innerHTML = damages.reduce((a, b) => a + b, 0);

}


</script>

</body>
</html>
